BootStrap: docker
From: ubuntu:20.04
#From: ubuntu:18.04

%files

%environment

    export PATH=/usr/local:/usr/local/scripts:$PATH


%post
    apt-get update && apt-get install -y netcat
    NOW=`date`
    echo "export NOW=\"${NOW}\"" >> $SINGULARITY_ENVIRONMENT
    apt-get install -y wget
    apt-get install -y unzip
    apt-get install -y rsync
    apt-get install -y tar
    apt-get install -y dialog
    apt-get install -y parallel
    apt-get install -y time
    
    DEBIAN_FRONTEND=noninteractive apt-get install -y appmenu-gtk2-module

    apt-get install -y software-properties-common
    add-apt-repository universe


    apt install -y python2
    apt-get install -y python3
    apt-get install -y python3-pip
    pip3 install --upgrade pip

    pip3 install pandas    
    pip3 install nibabel
    pip3 install matplotlib
    pip3 install scipy
    pip3 install IPython
    pip3 install mglearn
    pip3 install gevent
    pip3 install sklearn
    pip3 install seaborn
    pip3 install dask
    pip3 install psycopg2-binary    
    pip3 install sqlalchemy

# Install R
    apt install -y dirmngr gnupg apt-transport-https ca-certificates software-properties-common
    apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
    add-apt-repository 'deb https://cloud.r-project.org/bin/linux/ubuntu focal-cran40/'
    apt install -y r-base
    apt install -y build-essential

    mkdir /usr/local/r
    echo "install.packages('datasets')" >> /usr/local/r/packages.R
    echo "install.packages('h2o')" >> /usr/local/r/packages.R
    echo "install.packages('Hmisc')" >> /usr/local/r/packages.R
    echo "install.packages('caret')" >> /usr/local/r/packages.R
    echo "install.packages('kernlab')" >> /usr/local/r/packages.R
    echo "install.packages('tidyverse')" >> /usr/local/r/packages.R
    echo "install.packages('xgboost')" >> /usr/local/r/packages.R
    echo "install.packages('Matrix')" >> /usr/local/r/packages.R
    echo "install.packages('dplyr')" >> /usr/local/r/packages.R
    echo "install.packages('lolR')" >> /usr/local/r/packages.R
    echo "install.packages('ggplot2')" >> /usr/local/r/packages.R
    echo "install.packages('factoextra')" >> /usr/local/r/packages.R
    echo "install.packages('nnet')" >> /usr/local/r/packages.R
    echo "install.packages('pROC')" >> /usr/local/r/packages.R
    echo "install.packages('ggpubr')" >> /usr/local/r/packages.R
    echo "install.packages('rpart')" >> /usr/local/r/packages.R
    echo "install.packages('tidyr')" >> /usr/local/r/packages.R
    echo "install.packages('tidymodels')" >> /usr/local/r/packages.R
    echo "install.packages('car')" >> /usr/local/r/packages.R
    echo "install.packages('mgcv')" >> /usr/local/r/packages.R    
    echo "install.packages('randomForest')" >> /usr/local/r/packages.R
    echo "install.packages('multcomp')" >> /usr/local/r/packages.R
    echo "install.packages('glmnet')" >> /usr/local/r/packages.R
    echo "install.packages('data.table')" >> /usr/local/r/packages.R
    echo "install.packages('parallel')" >> /usr/local/r/packages.R    
    
    Rscript /usr/local/r/packages.R

%runscript    
    echo "Arguments received: first: $1    all:$*"
    /bin/bash $*


%labels
    Author dmattie
