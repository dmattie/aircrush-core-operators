BootStrap: docker
From: ubuntu:20.04
#From: ubuntu:18.04

%files

    #df-analyze /usr/local

%environment
    export LC_ALL=C
    export PATH=/usr/local:/usr/local/scripts:/usr/local/df-analyze:$PATH:$HOME/.poetry/bin

%post
    apt-get update && apt-get install -y netcat
    NOW=`date`
    echo "export NOW=\"${NOW}\"" >> $SINGULARITY_ENVIRONMENT
   
    apt-get install -y curl    
    apt-get install -y git

    cd /
    git clone https://github.com/stfxecutables/df-analyze.git

    DEBIAN_FRONTEND=noninteractive
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    apt-get install -y software-properties-common
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    add-apt-repository universe
    
    echo "#########################################################"
    echo "#########################################################"
    echo "#########################################################"
    echo "#########################################################"
    
    apt-get install -y python3

    


    curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python3 -

    
    cd /df-analyze
    poetry install
    
    
%runscript    
    poetry shell
    echo "Arguments received: first: $1    all:$*"
    /bin/bash $*


%labels
    Container Author: dmattie


###############
# df-analyze
###############
%apphelp df-analyze
    https://github.com/stfxecutables/df-analyze/blob/master/README.md
%apprun df-analyze
    SCRIPT_HOME=/usr/local/df-analyze
    
    python3 $SCRIPT_HOME/df-analyze.py $*
    