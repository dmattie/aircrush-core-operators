BootStrap: docker
From: ubuntu:20.04
#From: ubuntu:18.04

%files

    #df-analyze /usr/local

%environment
    export LC_ALL=C
    export PATH=/usr/local:/usr/local/scripts:/usr/local/df-analyze:$PATH:$HOME/.poetry/bin

%post
    apt-get update && apt-get install -y netcat
    NOW=`date`
    echo "export NOW=\"${NOW}\"" >> $SINGULARITY_ENVIRONMENT
   
    apt-get install -y curl
    #DEBIAN_FRONTEND=noninteractive 
    apt-get install -y git

    cd /
    git clone https://github.com/stfxecutables/df-analyze.git
    apt-get install -y software-properties-common
    add-apt-repository universe

    apt-get install -y python3
    apt-get install -y python3-pip
    pip3 install --upgrade pip

    curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python3 -

    #chmod -R a+rx /usr/local/scripts
    cd /usr/local
    #git clone https://github.com/stfxecutables/df-analyze.git
    #apt-get uninstall -y git
    cd df-analyze
    poetry install
    poetry shell
    
%runscript    
    echo "Arguments received: first: $1    all:$*"
    /bin/bash $*


%labels
    Container Author: dmattie


###############
# df-analyze
###############
%apphelp df-analyze
    https://github.com/stfxecutables/df-analyze/blob/master/README.md
%apprun df-analyze
    SCRIPT_HOME=/usr/local/df-analyze
    
    python3 $SCRIPT_HOME/df-analyze.py $*
    