BootStrap: docker
From: ubuntu:20.04
#From: ubuntu:18.04

%files

    #df-analyze /usr/local

%environment
    export LC_ALL=C
    export PATH=/usr/local:/usr/local/scripts:/usr/local/df-analyze:$PATH:$HOME/.poetry/bin

%post
apt-get update && apt-get install -y netcat
    NOW=`date`
    echo "export NOW=\"${NOW}\"" >> $SINGULARITY_ENVIRONMENT
    apt-get install -y wget
    apt-get install -y unzip
    apt-get install -y rsync
    apt-get install -y tar
    apt-get install -y dialog
    apt-get install -y parallel
    apt-get install -y time
    
    DEBIAN_FRONTEND=noninteractive apt-get install -y appmenu-gtk2-module
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    apt-get install -y software-properties-common
    echo "#########################################################"
    echo "#########################################################"
    echo "#########################################################"
    echo "#########################################################"
    add-apt-repository universe

    apt-get install -y curl    
    apt-get install -y git

    cd /
    git clone https://github.com/stfxecutables/df-analyze.git
    
    apt-get install -y python3
    echo "PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP"
    echo "PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP"
    echo "PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP"
    echo "PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP"
    curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python3 -
    export PATH=$PATH:$HOME/.poetry/bin
    ls $HOME/.poetry/bin
    . $HOME/.poetry/env
    
    cd /df-analyze

    apt-get install -y python3-distutils
    apt-get install -y python3-apt

    poetry install
    poetry config --list
    mkdir -p /usr/local/poetry/.poetry
    mkdir -p /usr/local/poetry/virtualenvs

    poetry config virtualenvs.path /usr/local/poetry/virtualenvs
    cp -r $HOME/.poetry /usr/local/poetry/.poetry

    
    
%runscript  
    
    . $HOME/.poetry/env
    poetry shell
    echo "Arguments received: first: $1    all:$*"
    /bin/bash $*


%labels
    Container Author: dmattie


###############
# df-analyze
###############
%apphelp df-analyze
    https://github.com/stfxecutables/df-analyze/blob/master/README.md
%apprun df-analyze
    SCRIPT_HOME=/usr/local/df-analyze
    
    python3 $SCRIPT_HOME/df-analyze.py $*
    